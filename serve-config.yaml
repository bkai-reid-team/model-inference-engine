http_options:
  host: 0.0.0.0
  port: 8008

applications:
  - name: ray-serve-app
    route_prefix: /
    import_path: serve_app:app
    runtime_env:
      env_vars:
        MODEL_BACKEND: "vllm"
      
    deployments:
      # 1. ROUTER DEPLOYMENT (Không cần GPU)
      - name: Router
        # ...
        ray_actor_options:
          num_gpus: 0
          
      # 2. QWEN (LLM LỚN - Ưu tiên memory)
      - name: QwenAPI
        ray_actor_options:
          num_gpus: 0.5 # 50% GPU (khoảng 22.5 GiB memory)
          # Cần điều chỉnh memory limit tùy theo kích thước Qwen nếu Qwen quá lớn
          
      # 3. EMBEDDING (Mô hình TEXT - Thường đủ nhẹ để dùng CPU hoặc chia sẻ GPU thấp)
      - name: EmbeddingAPI
        ray_actor_options:
          num_gpus: 0
          
      # 4. MOBILENET (Mô hình RẤT NHỎ - 3 replica)
      - name: MobilenetClassifier
        # Cho phép 5 bản sao cùng chia sẻ 1 GPU (0.2 * 5 = 1.0)
        # 3 replicas * 0.1 = 0.3 GPU
        ray_actor_options:
          num_gpus: 0.1 
        autoscaling_config:
          min_replicas: 3
          max_replicas: 3 # Giữ cố định 3 replica
          
      # 5. EFFICIENTNET B0 (Mô hình NHỎ - 3 replica)
      - name: EfficientNetB0Classifier
        # 3 replicas * 0.1 = 0.3 GPU
        ray_actor_options:
          num_gpus: 0.1 
        autoscaling_config:
          min_replicas: 3
          max_replicas: 3
          
      # 6. EFFICIENTNET B4 (Mô hình LỚN NHẤT TRONG BỘ CLASSIFIER - 3 replica)
      - name: EfficientNetB4Classifier
        # 3 replicas * 0.1 = 0.3 GPU
        # Dùng 0.1 GPU/replica là rủi ro OOM, nhưng cần thiết để tổng <= 1.0
        ray_actor_options:
          num_gpus: 0.1 
        autoscaling_config:
          min_replicas: 3
          max_replicas: 3